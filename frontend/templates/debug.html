<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æ•°æ®åˆ†æè°ƒè¯•é¡µé¢</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h1>æ•°æ®åˆ†æåŠŸèƒ½è°ƒè¯•</h1>
        
        <div class="row mt-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5>APIæµ‹è¯•</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-primary me-2" onclick="testCoverageAPI()">æµ‹è¯•è¦†ç›–API</button>
                        <button class="btn btn-success me-2" onclick="testDifficultyAPI()">æµ‹è¯•éš¾åº¦API</button>
                        <button class="btn btn-info me-2" onclick="testTypeAPI()">æµ‹è¯•ç±»å‹API</button>
                        <button class="btn btn-warning me-2" onclick="testAccuracyAPI()">æµ‹è¯•å‡†ç¡®ç‡API</button>
                        <button class="btn btn-danger" onclick="clearResults()">æ¸…ç©ºç»“æœ</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5>æµ‹è¯•ç»“æœ</h5>
                    </div>
                    <div class="card-body">
                        <div id="test-results" style="height: 400px; overflow-y: auto; border: 1px solid #ddd; padding: 10px;">
                            <p class="text-muted">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = '/api';
        
        function log(message, type = 'info') {
            const results = document.getElementById('test-results');
            const timestamp = new Date().toLocaleTimeString();
            const color = {
                'info': 'text-primary',
                'success': 'text-success', 
                'error': 'text-danger',
                'warning': 'text-warning'
            }[type] || 'text-dark';
            
            results.innerHTML += `<div class="${color}">[${timestamp}] ${message}</div>`;
            results.scrollTop = results.scrollHeight;
        }
        
        function clearResults() {
            document.getElementById('test-results').innerHTML = '<p class="text-muted">ç»“æœå·²æ¸…ç©º...</p>';
        }
        
        async function testCoverageAPI() {
            log('ğŸ” æµ‹è¯•çŸ¥è¯†ç‚¹è¦†ç›–API...', 'info');
            try {
                const response = await fetch(`${API_BASE_URL}/analytics/coverage`);
                log(`ğŸ“¡ APIå“åº”çŠ¶æ€: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');
                
                if (response.ok) {
                    const data = await response.json();
                    log(`ğŸ“Š è¦†ç›–æ•°æ®: æ€»çŸ¥è¯†ç‚¹ ${data.summary?.total_knowledge_points || 0}, è¦†ç›–ç‡ ${data.summary?.coverage_rate || 0}%`, 'success');
                    log(`ğŸ“‹ æ•°æ®è¯¦æƒ…: ${JSON.stringify(data, null, 2)}`, 'info');
                } else {
                    log(`âŒ APIè°ƒç”¨å¤±è´¥: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`âŒ ç½‘ç»œé”™è¯¯: ${error.message}`, 'error');
            }
        }
        
        async function testDifficultyAPI() {
            log('ğŸ” æµ‹è¯•éš¾åº¦åˆ†å¸ƒAPI...', 'info');
            try {
                const response = await fetch(`${API_BASE_URL}/analytics/difficulty-distribution`);
                log(`ğŸ“¡ APIå“åº”çŠ¶æ€: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');
                
                if (response.ok) {
                    const data = await response.json();
                    log(`ğŸ“Š éš¾åº¦åˆ†å¸ƒ: æ€»é¢˜ç›® ${data.total_questions || 0}`, 'success');
                    log(`ğŸ“‹ åˆ†å¸ƒè¯¦æƒ…: ${JSON.stringify(data.difficulty_distribution || [], null, 2)}`, 'info');
                } else {
                    log(`âŒ APIè°ƒç”¨å¤±è´¥: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`âŒ ç½‘ç»œé”™è¯¯: ${error.message}`, 'error');
            }
        }
        
        async function testTypeAPI() {
            log('ğŸ” æµ‹è¯•ç±»å‹åˆ†å¸ƒAPI...', 'info');
            try {
                const response = await fetch(`${API_BASE_URL}/analytics/type-distribution`);
                log(`ğŸ“¡ APIå“åº”çŠ¶æ€: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');
                
                if (response.ok) {
                    const data = await response.json();
                    log(`ğŸ“Š ç±»å‹åˆ†å¸ƒ: æ€»é¢˜ç›® ${data.total_questions || 0}`, 'success');
                    log(`ğŸ“‹ åˆ†å¸ƒè¯¦æƒ…: ${JSON.stringify(data.type_distribution || [], null, 2)}`, 'info');
                } else {
                    log(`âŒ APIè°ƒç”¨å¤±è´¥: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`âŒ ç½‘ç»œé”™è¯¯: ${error.message}`, 'error');
            }
        }
        
        async function testAccuracyAPI() {
            log('ğŸ” æµ‹è¯•AIå‡†ç¡®ç‡API...', 'info');
            try {
                const response = await fetch(`${API_BASE_URL}/analytics/ai-agent-accuracy`);
                log(`ğŸ“¡ APIå“åº”çŠ¶æ€: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');
                
                if (response.ok) {
                    const data = await response.json();
                    log(`ğŸ¤– AIå‡†ç¡®ç‡: ${data.accuracy_analysis?.accuracy_rate || 0}%`, 'success');
                    log(`ğŸ“‹ å‡†ç¡®ç‡è¯¦æƒ…: ${JSON.stringify(data, null, 2)}`, 'info');
                } else {
                    log(`âŒ APIè°ƒç”¨å¤±è´¥: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`âŒ ç½‘ç»œé”™è¯¯: ${error.message}`, 'error');
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸš€ é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹è‡ªåŠ¨æµ‹è¯•æ‰€æœ‰API...', 'info');
            setTimeout(testCoverageAPI, 1000);
            setTimeout(testDifficultyAPI, 2000);
            setTimeout(testTypeAPI, 3000);
            setTimeout(testAccuracyAPI, 4000);
        });
    </script>
</body>
</html>
