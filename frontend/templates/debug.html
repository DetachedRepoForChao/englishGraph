<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>数据分析调试页面</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h1>数据分析功能调试</h1>
        
        <div class="row mt-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5>API测试</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-primary me-2" onclick="testCoverageAPI()">测试覆盖API</button>
                        <button class="btn btn-success me-2" onclick="testDifficultyAPI()">测试难度API</button>
                        <button class="btn btn-info me-2" onclick="testTypeAPI()">测试类型API</button>
                        <button class="btn btn-warning me-2" onclick="testAccuracyAPI()">测试准确率API</button>
                        <button class="btn btn-danger" onclick="clearResults()">清空结果</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5>测试结果</h5>
                    </div>
                    <div class="card-body">
                        <div id="test-results" style="height: 400px; overflow-y: auto; border: 1px solid #ddd; padding: 10px;">
                            <p class="text-muted">点击上方按钮开始测试...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = '/api';
        
        function log(message, type = 'info') {
            const results = document.getElementById('test-results');
            const timestamp = new Date().toLocaleTimeString();
            const color = {
                'info': 'text-primary',
                'success': 'text-success', 
                'error': 'text-danger',
                'warning': 'text-warning'
            }[type] || 'text-dark';
            
            results.innerHTML += `<div class="${color}">[${timestamp}] ${message}</div>`;
            results.scrollTop = results.scrollHeight;
        }
        
        function clearResults() {
            document.getElementById('test-results').innerHTML = '<p class="text-muted">结果已清空...</p>';
        }
        
        async function testCoverageAPI() {
            log('🔍 测试知识点覆盖API...', 'info');
            try {
                const response = await fetch(`${API_BASE_URL}/analytics/coverage`);
                log(`📡 API响应状态: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');
                
                if (response.ok) {
                    const data = await response.json();
                    log(`📊 覆盖数据: 总知识点 ${data.summary?.total_knowledge_points || 0}, 覆盖率 ${data.summary?.coverage_rate || 0}%`, 'success');
                    log(`📋 数据详情: ${JSON.stringify(data, null, 2)}`, 'info');
                } else {
                    log(`❌ API调用失败: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`❌ 网络错误: ${error.message}`, 'error');
            }
        }
        
        async function testDifficultyAPI() {
            log('🔍 测试难度分布API...', 'info');
            try {
                const response = await fetch(`${API_BASE_URL}/analytics/difficulty-distribution`);
                log(`📡 API响应状态: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');
                
                if (response.ok) {
                    const data = await response.json();
                    log(`📊 难度分布: 总题目 ${data.total_questions || 0}`, 'success');
                    log(`📋 分布详情: ${JSON.stringify(data.difficulty_distribution || [], null, 2)}`, 'info');
                } else {
                    log(`❌ API调用失败: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`❌ 网络错误: ${error.message}`, 'error');
            }
        }
        
        async function testTypeAPI() {
            log('🔍 测试类型分布API...', 'info');
            try {
                const response = await fetch(`${API_BASE_URL}/analytics/type-distribution`);
                log(`📡 API响应状态: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');
                
                if (response.ok) {
                    const data = await response.json();
                    log(`📊 类型分布: 总题目 ${data.total_questions || 0}`, 'success');
                    log(`📋 分布详情: ${JSON.stringify(data.type_distribution || [], null, 2)}`, 'info');
                } else {
                    log(`❌ API调用失败: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`❌ 网络错误: ${error.message}`, 'error');
            }
        }
        
        async function testAccuracyAPI() {
            log('🔍 测试AI准确率API...', 'info');
            try {
                const response = await fetch(`${API_BASE_URL}/analytics/ai-agent-accuracy`);
                log(`📡 API响应状态: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');
                
                if (response.ok) {
                    const data = await response.json();
                    log(`🤖 AI准确率: ${data.accuracy_analysis?.accuracy_rate || 0}%`, 'success');
                    log(`📋 准确率详情: ${JSON.stringify(data, null, 2)}`, 'info');
                } else {
                    log(`❌ API调用失败: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`❌ 网络错误: ${error.message}`, 'error');
            }
        }
        
        // 页面加载时自动测试
        document.addEventListener('DOMContentLoaded', function() {
            log('🚀 页面加载完成，开始自动测试所有API...', 'info');
            setTimeout(testCoverageAPI, 1000);
            setTimeout(testDifficultyAPI, 2000);
            setTimeout(testTypeAPI, 3000);
            setTimeout(testAccuracyAPI, 4000);
        });
    </script>
</body>
</html>
